"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e("object"===("undefined"==typeof exports?"undefined":_typeof(exports))?require("jquery"):jQuery)}(function(e){function t(n,i){this.$element=e(n),this.options=e.extend({},t.DEFAULTS,e.isPlainObject(i)&&i),this.init()}var n=e("body"),i="qor.widget",o="enable."+i,r="disable."+i,s="change."+i,a='select[name="QorResource.Widgets"]',l='[name="QorResource.Kind"]',d='[name="QorResource.Widgets"],[name="QorResource.Template"]',c="qor-layout__widget-new",f=".qor-form-section",u=".qor-layout__widget-setting";return t.prototype={constructor:t,init:function(){this.bind(),this.isNewForm=this.$element.hasClass(c),this.addWidgetSlideout(),this.initSelect()},bind:function(){this.$element.on(s,"select",this.change.bind(this))},unbind:function(){this.$element.off(s,"select",this.change.bind(this))},initSelect:function(){var t=this.$element,n=t.find("select").filter(d),i=e(l),o='<h2 class="qor-page__tips">'+t.data("hint")+"</h2>";n.closest(f).hide(),n.each(function(){e(this).find("option").filter('[value!=""]').size()>=2&&e(this).closest(f).show()}),this.isNewForm?e(a).trigger("change"):i.parent().next(".qor-form-section-rows").children().length||(i.parent().next(".qor-form-section-rows").append(o),t.find(".qor-field__label").not(i.closest(".qor-form-section").find(".qor-field__label")).is(":visible")||(i.closest(".qor-form-section").hide(),t.append(o).parent().find(".qor-form__actions").remove()))},addWidgetSlideout:function(){var t,i,o=e(a),r=n.data("tabScopeActive"),s=e(".qor-slideout").is(":visible"),l=o.closest("form"),d=l.data("action-url")||l.prop("action"),c=d.indexOf("?")!==-1?"&":"?";o.find("option").each(function(){var n=e(this),a=n.val();a&&(t=""+d+c+"widget_type="+a,r&&(t=t+"&widget_scope="+r),i=s?"<a href="+t+' style="display: none;" class="qor-widget-'+a+'" data-open-type="slideout" data-url="'+t+'">'+a+"</a>":"<a href="+t+' style="display: none;" class="qor-widget-'+a+'">'+a+"</a>",o.after(i))})},change:function(t){var n=e(t.target),i=n.val(),o=e(".qor-slideout").is(":visible"),r=".qor-widget-"+i,s=e(r),l=s.prop("href");if(n.is(a))return e.fn.qorSlideoutBeforeHide=null,window.onbeforeunload=null,this.isNewForm?this.getFormHtml(l):o?s.trigger("click"):location.href=l,!1},getFormHtml:function(n){var i=e(u),o=e(t.TEMPLATE_LOADING).appendTo(i);window.componentHandler.upgradeElement(o.children()[0]),e.get(n,function(e){i.html(e).trigger("enable")}).fail(function(){window.alert("server error, please try again!")})},destroy:function(){this.unbind(),this.$element.removeData(i)}},t.DEFAULTS={},t.TEMPLATE_LOADING='<div style="text-align: center; margin-top: 30px;"><div class="mdl-spinner mdl-js-spinner is-active qor-layout__bottomsheet-spinner"></div></div>',t.plugin=function(n){return this.each(function(){var o,r=e(this),s=r.data(i);if(!s){if(/destroy/.test(n))return;r.data(i,s=new t(this,n))}"string"==typeof n&&e.isFunction(o=s[n])&&o.apply(s)})},e(function(){var n='[data-toggle="qor.widget"]';e(document).on(r,function(i){t.plugin.call(e(n,i.target),"destroy")}).on(o,function(i){t.plugin.call(e(n,i.target))}).triggerHandler(o),e(".qor-page__header .qor-page-subnav__header").length&&e(".mdl-layout__content").addClass("has-subnav")}),t});